# âš ï¸  AVISO IMPORTANTE: Collector NÃƒO deve rodar em Docker
#
# O collector precisa acessar mÃ©tricas REAIS do host fÃ­sico.
# Mesmo com volumes montados (/proc, /sys), containers tÃªm limitaÃ§Ãµes:
# - Namespace isolado
# - RestriÃ§Ãµes de acesso a hardware
# - MÃ©tricas podem ser imprecisas ou incompletas
#
# âœ… INSTALAÃ‡ÃƒO CORRETA DO COLLECTOR:
#    sudo ./scripts/install.sh
#
#    Isso instala o collector como serviÃ§o systemd nativo que:
#    - Acessa diretamente /proc, /sys, /dev do host
#    - Coleta mÃ©tricas 100% precisas
#    - Inicia automaticamente com o sistema
#    - Roda na porta 5253
#
# ğŸ“¦ Este docker-compose Ã© OPCIONAL apenas para o frontend
#    Alternativa: rodar nativamente com "cd web-frontend && npm run dev"

services:
  # Frontend Web (OPCIONAL - pode rodar nativamente)
  frontend:
    build:
      context: ./web-frontend
      dockerfile: Dockerfile
    container_name: system-monitor-frontend
    ports:
      - "5252:80"
    environment:
      # Frontend acessa o collector rodando no HOST (nÃ£o em container)
      - VITE_API_URL=http://host.docker.internal:5253
    extra_hosts:
      # Permite acesso ao collector no host via host.docker.internal
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ğŸ“– INSTRUÃ‡Ã•ES DE USO
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# 1ï¸âƒ£  Instalar o COLLECTOR no host (OBRIGATÃ“RIO):
#     sudo ./scripts/install.sh
#
# 2ï¸âƒ£  Verificar se o collector estÃ¡ rodando:
#     sudo systemctl status system-monitor-collector
#     curl http://localhost:5253/health
#
# 3ï¸âƒ£  Rodar o FRONTEND (escolha uma opÃ§Ã£o):
#
#     OpÃ§Ã£o A - Nativo (recomendado para desenvolvimento):
#       cd web-frontend
#       npm install
#       npm run dev
#       # Acesse: http://localhost:5252
#
#     OpÃ§Ã£o B - Docker (isolamento):
#       docker compose up -d frontend
#       # Acesse: http://localhost:5252
#
# 4ï¸âƒ£  Desinstalar o collector:
#     sudo ./scripts/uninstall.sh
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
